deploy jrnkinss and sonar in ec2


 <img width="488" height="192" alt="image" src="https://github.com/user-attachments/assets/5795f19b-f319-4ece-8f60-52d5c0ce3171" />

connect to ec2 instance using SSH key pair from local

Jenkins Sonar And Argo CD Doc

Create an ec2 instance t2.xlarge

Connect ec2 with ssh from local

Installations
Maven

sudo yum update
sudo yum install -y maven
mvn -version


Now Install open jdk 11 

sudo yum install java-11-amazon-corretto-headless

Note - cretate SSH  public/private key to acess from local(another sytem)
publuic key for argocd add to github and private key to argocd

creatye argoi cd application.yaml to connect app to argocd and do kubectl apply -f
https://github.com/udemy-dev-withK8s-AWS-codedecode/deployment-folder/tree/master/application%20resource

Now Install Docker

sudo yum update -y
sudo yum install -y docker
sudo service docker start 
sudo chkconfig docker on - This command configures the Docker service to start automatically on system boot

Overall, these commands update the system, install Docker, start the Docker service, and set it to automatically start on system boot, allowing you to work with Docker and run containerized applications on your Linux system.

Now install Jenkins

sudo wget -O /etc/yum.repos.d/jenkins.repo \
    https://pkg.jenkins.io/redhat-stable/jenkins.repo
sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io-2023.key
sudo yum install jenkins -y
sudo systemctl enable jenkins
sudo systemctl start jenkins

yum update -y yum.noarch


Install Node 

curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.3/install.sh | bash

. ~/.nvm/nvm.sh

nvm install 16

Verification: 
node -e "console.log('Running Node.js ' + process.version)"


Install Git
sudo yum install -y git



<img width="960" height="600" alt="image" src="https://github.com/user-attachments/assets/ed465d81-98c4-49d8-88e5-21c98d3165d5" />




To check the status of jenkins

sudo systemctl status jenkins


After this get password from below command in jenkins 

sudo cat /var/lib/jenkins/secrets/initialAdminPassword


After Jenkins installation add ssh plugin
Manage jenkins - plugin
Available plugin - SSH Agent - install without restart
Manage jenkins - tools- Add Maven


argocd will detect changes in nanifest files and deploy latest codein environment





















To integrate webhook in jenkins

<img width="960" height="600" alt="image" src="https://github.com/user-attachments/assets/888d0609-e83a-4d17-a37f-97db3147c7ae" />

Create ssh key in jenkins server using command
ssh-keygen -t rsa -b 4096

Command to fetch public key - 
cat ~/.ssh/id_rsa.pub

Command to fetch private key - 
cat ~/.ssh/id_rsa



Add this public key in git hub . go to setting go to ssh key and add new key

Add private key in jenkins now
Go to jenkins - manage jenkins - credentials - Add ssh username with private key


Add docker creds - username with password
Codedecode25
DOCKER_HUB_CREDENTIAL - id


Also add this no verification which will be used during git push

<img width="508" height="253" alt="image" src="https://github.com/user-attachments/assets/a7cb5d99-8514-4e90-97fc-82795e520c50" />


<img width="524" height="278" alt="image" src="https://github.com/user-attachments/assets/578841ac-b048-47ac-8df2-b4ab20574afa" />

<img width="516" height="293" alt="image" src="https://github.com/user-attachments/assets/cc87325c-3f39-4a98-87b6-066ed74ae796" />



sav e n add dummy commit build automatically triggers
Nowcheck manifest file







To provide access to docker
sudo usermod -aG docker jenkins

Restart jenkins after that
sudo service jenkins restart







Sonar

Run Sonar in docker using below command
docker run -d -p 9000:9000 --name sonarqube sonarqube

To check the logs
 docker logs -f sonarqube

Hit 
15.188.80.32:9000 for sonar dashboard and username password will be admin

To generate token go to sonar dashboard
Click on user icon - my account - security and create new token


Quality GAtes

<img width="530" height="325" alt="image" src="https://github.com/user-attachments/assets/505498b4-ca0c-4e83-9a51-441a87e62caa" />


Now put following dependencies in pom

<plugin>
   <groupId>org.apache.maven.plugins</groupId>
   <artifactId>maven-compiler-plugin</artifactId>
   <configuration>
      <source>1.8</source>
      <target>1.8</target>
      <annotationProcessorPaths>
         <path>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <version>1.18.26</version>
         </path>
         <path>
            <groupId>org.mapstruct</groupId>
            <artifactId>mapstruct-processor</artifactId>
            <version>1.4.2.Final</version>
         </path>
      </annotationProcessorPaths>
   </configuration>
</plugin>
<plugin>
   <groupId>org.sonarsource.scanner.maven</groupId>
   <artifactId>sonar-maven-plugin</artifactId>
   <version>3.8.0.2131</version>
</plugin>
<plugin>
   <groupId>org.jacoco</groupId>
   <artifactId>jacoco-maven-plugin</artifactId>
   <version>0.8.8</version>
   <executions>
      <execution>
         <id>prepare-agent</id>
         <goals>
            <goal>prepare-agent</goal>
         </goals>
      </execution>
      <execution>
         <id>report</id>
         <goals>
            <goal>report</goal>
         </goals>
      </execution>
   </executions>
</plugin>


Add this command in properties
 <sonar.exclusions>**/com/codeddecode/restaurantlisting/dto/** , **/*/com/codeddecode/restaurantlisting/entity/**/*</sonar.exclusions>




To generate token go to sonar dashboard
Click on user icon - my account - security and create new token


Where to get component key
Click on project – project setting – update key
Here you will find component key
<groupId>:<artifactId>






Run sonar using below command
mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent install sonar:sonar -Dsonar.host.url=http://localhost:9000/ -Dsonar.login=squ_a44ef243148d9f75cb3248851df2d555d5342ee2


After this delryr ptpject




















Argo CD

Command to install argo cd in cluster

kubectl create namespace argocd

kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml

kubectl port-forward svc/argocd-server -n argocd 8080:80

To Get the password
Initial username 
argocd admin initial-password -n argocd

To install argocd cli
choco install argocd-cli 

Create ssh key in jenkins server using command
ssh-keygen -t rsa -b 4096

Command to fetch public key - 
cat ~/.ssh/id_rsa.pub

Command to fetch private key - 
cat ~/.ssh/id_rsa


To delete argocd completely
kubectl delete -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml

If pods are in terminating state 

kubectl delete pods --all -n argocd --grace-period=0 --force


Go to setting - repository - connect repo

Overall, the provided YAML describes an Argo CD "Application" resource that deploys application resources from a Git repository, with specific configuration options for the Argo CD Image Updater and synchronization behavior.




Add following things in security grp


Make jenkins file which containes scriptr that jenkins will exexute on any change in repository

https://github.com/udemy-dev-withK8s-AWS-codedecode/restaurant-listing-ms/blob/master/Jenkinsfile and build and push new image to docker with new tagg
