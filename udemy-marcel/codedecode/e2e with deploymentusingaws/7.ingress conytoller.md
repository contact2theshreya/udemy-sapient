## resources
https://www.youtube.com/shorts/PylhvTbqMKo

https://medium.com/@jadhav.swatissj99/why-do-we-need-to-use-ingress-in-kubernetes-5af453f7c935

external people should call FE application and ingres is used for routing to microservice internally
alb controller is ingress

Deployment Steps
According to the AWS documentation, follow the steps below:

Run the following command to download the required IAM policy file:

curl -O https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/v2.4.7/docs/install/iam_policy.json        

Create an IAM policy named "AWSLoadBalancerControllerIAMPolicy" using the downloaded policy document in your AWS region (e.g., eu-west-3):

aws iam create-policy --policy-name AWSLoadBalancerControllerIAMPolicy --policy-document file://iam_policy.json --region eu-west-3        

Associate the IAM OIDC provider with your EKS cluster in your AWS region (e.g., eu-west-3):

eksctl utils associate-iam-oidc-provider --region=eu-west-3 --cluster=aws-eks-cluster1 --approve        

Create an IAM service account for the "aws-load-balancer-controller" in the "kube-system" namespace of your EKS cluster (e.g., aws-eks-cluster1) in your AWS region (e.g., eu-west-3). Use the appropriate AWS account ID and IAM policy ARN:

eksctl create iamserviceaccount --cluster=aws-eks-cluster1 --namespace=kube-system --region eu-west-3 --name=aws-load-balancer-controller --role-name AmazonEKSLoadBalancerControllerRole --attach-policy-arn=arn:aws:iam::YOUR_AWS_ACCOUNT_ID:policy/AWSLoadBalancerControllerIAMPolicy --approve
Important: Ensure that you modify "782482296161" with your AWS account ID, replace "eu-west-3" with the appropriate AWS region, and substitute "aws-eks-cluster1" with the respective name of your AWS cluster.

       

Apply the Cert Manager YAML file for installation:

kubectl apply --validate=false -f https://github.com/jetstack/cert-manager/releases/download/v1.5.4/cert-manager.yaml        

Download the YAML file for the AWS Load Balancer Controller from the following URL:



Download YAML File        

Remove the specified code block from the downloaded YAML file:



apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app.kubernetes.io/component: controller
    app.kubernetes.io/name: aws-load-balancer-controller
  name: aws-load-balancer-controller
  namespace: kube-system
        
Edit the "Deployment" section in the YAML file by changing the following parameters:



spec:
      containers:
        - args:
            - --cluster-name=your-cluster-name
            - --ingress-class=alb
            - --aws-vpc-id=vpc-xxxxxxxx
            - --aws-region=region-code
        
Replace the image name with:

codedecode25/aws-load-balancer:v2.4.7       (present in public repo) 

Apply the edited YAML file:

kubectl apply -f v2_4_7_full.yaml    

//////////////////////
## ingess e2e deployment

1) create 2 folder in deployment file-ingress and ingress controller(aws has given us)-
https://github.com/udemy-dev-withK8s-AWS-codedecode/deployment-folder/blob/master/ingress%20controller/v2_4_7_full_modified.yaml

https://github.com/udemy-dev-withK8s-AWS-codedecode/deployment-folder/blob/master/aws/ingress.yml(written by us which contain all route to microservice and angular app)

3) kubectl apply -f ingress.yaml
4) on kubectl get ingress - u will get DNS(d1) external IP that u can use to hit from browser that external user can hit and see same dns in load balancer of aws

5) Give this DNS  as base path of all service in angular

6) run application (localhost) u will see data comning from pods

7) create image of angular app->manifest file->pod->

8) https://github.com/udemy-dev-withK8s-AWS-codedecode/deployment-folder/blob/master/aws/angular-manifest.yml

9) Now hit ingress DNS in browser and u will see application up and running
